<!DOCTYPE html>
<html>
<head>
<title>cardsorter</title>
<meta charset=utf-8>
<!-- fuck google -->
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type="text/javascript"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.8/jquery-ui.min.js" type="text/javascript"></script>
<script src="http://jquery-ui.googlecode.com/svn/tags/latest/external/jquery.bgiframe-2.1.2.js" type="text/javascript"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.8/i18n/jquery-ui-i18n.min.js" type="text/javascript"></script>
<link rel=stylesheet href="css/style.css" media=screen />
<link rel=stylesheet href="css/print.css" media=print />

<style>
body { 
  font-family: sans-serif;
}

textarea, div.sticky { 
  padding: 1em;
  cursor: pointer;
  font-size: small;
  overflow: auto;  
 } 

div#board { 
  width: 800px;
  height: 500px;
  margin: 0 auto;
background:#ccc;
  float:right;
}

div.sticky { 
   /* Firefox */  
   -moz-box-shadow: -3px 3px 10px rgba(66,66,66,1);  
   /* Safari+Chrome */  
   -webkit-box-shadow:  -5px 5px 7px rgba(66,66,66,.5);  
   /* Opera */  
   box-shadow:  -5px 5px 7px rgba(66,66,66,.5); 
  padding: 1em;
  cursor: pointer;
  background: yellow;
  font-size: small;
  width: 100px;  
  height: 100px;  
  border: 1px solid #FFCD00;  
  border-top: 10px solid #FFCD00;  
 } 

div.hidden { 
  visibility: hidden;
}

#board .sticky{
   -webkit-transform:rotate(-2deg);  
   -o-transform:rotate(-2deg);  
   -moz-transform:rotate(-2deg);  
}

#board div:nth-child(even) {  
   -o-transform:rotate(4deg);  
   -webkit-transform:rotate(4deg);  
   -moz-transform:rotate(4deg);  
   position:relative;  
   top:5px;  
 }  

#board div:nth-child(3n) {  
   -o-transform:rotate(-3deg);  
   -webkit-transform:rotate(-3deg);  
   -moz-transform:rotate(-3deg);  
   position:relative;  
   top:-5px;  
 }  
#board div:nth-child(5n) {  
   -o-transform:rotate(5deg);  
   -webkit-transform:rotate(5deg);  
   -moz-transform:rotate(5deg);  
   position:relative;  
   top:-10px;  
 }  

h1 { 
  float:right;
  padding: 0 1em;
  font-size: 90%;
}

button { 
  margin: 1em;
}

button#save { 
  right:0;
  bottom:0;
  position:fixed;
}

div#help { 
  padding: 1em;
  width: 300px; 
  font-size: small;
  left:0;
  bottom:0;
  position:fixed;
}

p#help_content { 
  border: 1px solid #565;
  padding: 1em;
}
  

a#toggle_help { 
  color: #666;
  text-decoration: none;
  font-weight:bold;
}

</style>

<script>

$(document).ready(function(){


  if(localStorage.stickies){
    var stickies = JSON.parse(localStorage.stickies);   
    $.each(stickies, function(i,sticky){
      $('<div>', {
        'css': sticky.css,
        'class': 'sticky',
        'text': sticky.text
      }).appendTo('#board')
    })
  }


  $('.sticky').draggable();

  $('p#help_content').hide(); 

  $('textarea').focus();

  $('#toggle_help').toggle(
   function(){ $('#help_content').show(); $('#toggle_help').html('close help'); },
   function(){ $('#help_content').hide(); $('#toggle_help').html('show help'); }
  )

  $('textarea').keyup(function(ev){

    if( ev.which == 13 && $('textarea').val().length > 0){

        $('<div></div>', {
          'text': $.trim($('textarea').val()),
          'class': 'sticky'
        })
        .css({
          //'left': Math.floor(Math.random() * 80) + '%',
          //'top': Math.floor(Math.random() * 80) + '%',
          //'left': Math.floor(Math.random() * $('#board').width()),
          //'top': Math.floor(Math.random() * $('#board').height())
          'left': Math.floor(Math.random() * $('#board').width()) * .6 + 'px',
          'top': Math.floor(Math.random() * $('#board').height()) * .6 + 'px',
          'position': 'relative' 
        })
        .appendTo($('#board'));

        $('textarea').val('').focus();

        $('.sticky').draggable({ });
          //'stop' : function(){ console.log( JSON.stringify({'top': $(this).position().top, 'left': $(this).position().left,  'content' : $(this).html() }, null, 2)  ) } 

    }

  });


  $( "div.sticky" ).live('dblclick', function(){ 
    $(this).addClass('hidden') ;
    $('.sticky').draggable({ });
  } ) ;


  $('#save').live('click', function(){ 
    var stickies = []; 
    $.each($('div.sticky').not('.hidden'), function(i, sticky) { 
      stickies.push({  
        'top': $(this).css('top'),
        'text': $(this).text(),
        'left': $(this).css('left'),
      }) 
    })  
  
    localStorage.stickies = JSON.stringify(stickies);
    console.log(localStorage.stickies);
  })




})

</script>
</head>

<body>

<h1>ctldc card sort</h1>
<textarea></textarea>
<div id=board></div>

<button id=save>save</button>
<div id=help>
<p id=help_content>Type in the box and press enter to create a new note. Double click a note to delete it. Click save to persist your notes across sessions. </p>
<p><a id=toggle_help href=#toggle_help>show help</a></p>
</div>
</body>
</html>
